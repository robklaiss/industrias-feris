#!/usr/bin/env python3
"""Extraer y revisar el lote del payload"""

import lxml.etree as etree
import base64
import zipfile
import io

# Payload de prueba
payload = '<rEnvioLote xmlns="http://ekuatia.set.gov.py/sifen/xsd"><dId>202601181622163</dId><xDE>UEsDBBQAAAAAAMiCMlyTuh+LNx8AADcfAAAMAAAAeG1sX2ZpbGUueG1sPD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiPz48ckxvdGVERT48ckxvdGVERSB4bWxucz0iaHR0cDovL2VrdWF0aWEuc2V0Lmdvdi5weS9zaWZlbi94c2QiPjxyREUgSWQ9InJERTAxODAwNDU1NDczNzAxMDAxMDAwMDAwMTIwMjYwMTE4MTEzMjI0MTIzNDU2Nzg5Ij48ZFZlckZvcj4xNTA8L2RWZXJGb3I+PERFIElkPSIwMTgwMDQ1NTQ3MzcwMDEwMDEwMDAwMDEyMDI2MDExODExMzIyNDEyMzQ1Njc4OSI+PGREVklkPjE8L2REVklkPjxkRmVjRmlybWE+MjAyNi0wMS0xOFQxMTozMjoyNC4xNTk5NTM8L2RGZWNGaXJtYT48ZFNpc0ZhY3Q+MTwvZFNpc0ZhY3Q+PGdPcGVERT48aVRpcEVtaT4xPC9pVGlwRW1pPjxkRGVzVGlwRW1pPk5vcm1hbDwvZERlc1RpcEVtaT48ZENvZFNlZz4wMDAwMDAwMjM8L2RDb2RTZWc+PGRJbmZvRW1pPjE8L2RJbmZvRW1pPjxkSW5mb0Zpc2M+SW5mb3JtYWNpw7NuIGRlIGludGVyw6lzIGRlbCBGaXNjbyByZXNwZWN0byBhbCBERTwvZEluZm9GaXNjPjwvZ09wZURFPjxnVGltYj48aVRpREU+MTwvaVRpREU+PGREZXNUaURFPkZhY3R1cmEgZWxlY3Ryw7NuaWNhPC9kRGVzVGlERT48ZE51bVRpbT4xMjM0NTY3ODwvZE51bVRpbT48ZEVzdD4wMDE8L2RFc3Q+PGRQdW5FeHA+MDAxPC9kUHVuRXhwPjxkTnVtRG9jPjEwMDAwNTA8L2ROdW1Eb2M+PGRTZXJpZU51bT5BQjwvZFNlcmllTnVtPjxkRmVJbmlUPjIwMTktMDgtMTM8L2RGZUluaVQ+PC9nVGltYj48Z0RhdEdyYWxPcGU+PGRGZUVtaURFPjIwMjYtMDEtMThUMTE6MzI6MjQuMTU5OTc1PC9kRmVFbWlERT48Z09wZUNvbT48aVRpcFRyYT4xPC9pVGlwVHJhPjxkRGVzVGlwVHJhPlZlbnRhIGRlIG1lcmNhZGVyw61hPC9kRGVzVGlwVHJhPjxpVEltcD4xPC9pVEltcD48ZERlc1RJbXA+SVZBPC9kRGVzVEltcD48Y01vbmVPcGU+UFlHPC9jTW9uZU9wZT48ZERlc01vbmVPcGU+R3VhcmFuaTwvZERlc01vbmVPcGU+PC9nT3BlQ29tPjxnRW1pcz48ZFJ1Y0VtPjQ1NTQ3Mzc8L2RSdWNFbT48ZERWRW1pPjg8L2REVkVtaT48aVRpcENvbnQ+MjwvaVRpcENvbnQ+PGNUaXBSZWc+MzwvY1RpcFJlZz48ZE5vbUVtaT5JbmR1c3RyaWFzIEZlcmlzIFMuQS48L2ROb21FbWk+PGREaXJFbWk+Q0FMTEUgMSBDQVNJIENBTEUgMjwvZERpckVtaT48ZERlc0Nhc2M+MDwvZE51bUNhcz48Y0RlcEVtaT4xPC9jRGVwRW1pPjxkRGVzRGVwRW1pPkNBUElUQUw8L2Rlc0RlcEVtaT48Y0NpdUVtaT4xPC9jQ2l1RW1pPjxkRGVzQ2l1RW1pPkFTVU5DSU9OIChESVNUUklUTyk8L2Rlc0NpdUVtaT48ZFRlbEVtaT4wMTIxMjM0NTY8L2RURWxFbWk+ZEVtYWlsRT5jb3JyZW9AY29ycmVvLmNvbTwvZEVtYWlsRT48Z0FjdEVjbz48Y0FjdEVjbz40NjUxMDwvY0FjdEVjbz48ZERlc0FjdEVjbz5DT01FUkNJTyBERSBDRVJUSUZJQ0FETyBERSBOSVZFTCBERSBDRVJUSUZJQ0FETyBERSBOSVZFTCA8L2Rlc0FjdEVjbz48Z0FjdEVjbz48Y0FjdEVjbz4wMDwvY0FjdEVjbz48ZERlc0FjdEVjbz5TRVJWSUNJT1MgREUgQ0xBVkFET1JJQSBERSBDRVJUSUZJQ0FETyBERSBDRVJUSUZJQ0FETyBERSBDRVJUSUZJQ0FETyBERU5JVkVMPC9kZXNBY3RFY28+PC9nQWN0RWNvPjxnRGF0UmVjPjxkRGF0UmVjPjAyMDEyMzQ1NjwvZERhdFJlYz48ZERDb2RDbGllbnRlPkFBQTwvZERDb2RDbGllbnRlPjwvZ0RhdFJlYz48L2dEYXRHcmFsT3BlPjxnRHRpcERFPjxnQ2FtRkU+PGlJbmRQcmVzPjE8L2lJbmRQcmVzPjxkRGVzSW5kUHJlcz5PcGVyYWNpw7NuIHByZXNlbmNpYWw8L2REZXNJblByZXM+PC9nQ2FtRkU+PGdDYW1Db25kPjxpQ29uZE9wZT4yPC9pQ29uZE9wZT48ZERDb25kT3BlPkNyw6lkaXRvPC9kRENvbmRPcGU+PGdQYWdDcmVkPjxpQ29uZENyZWQ+MTwvaUNvbmRDcmVkPjxkRENvbmRDcmVkPlBsYXpvPC9kRENvbmRDcmVkPjxkUGxhem9DcmU+Mjg8L2RQbGF6b0NyZT48L2dQYWdDcmVkPjwvZ0NhbUNvbmQ+PGdDYW1JdGVtPjxkQ29kSW50PkNBQy9DVEFDPC9kQ29kSW50PjxkRGVzUHJvU2VyPkNVRU5UQVMgQUNUSVZBUzwvZERlc1Byb1Nlcj48Y1VuaU1lZD43NzwvY1VuaU1lZD48ZERlc1VuaU1lZD5VTkk8L2REZXNVbmlNZWQ+PGRDYW50UHJvU2VyPjE8L2RDYW50UHJvU2VyPjxkSW5mSXRlbT4yMTwvZEluZkl0ZW0+PGdWYWxvckl0ZW0+PGRQVW5pUHJvU2VyPjExMDAwMDA8L2RQVW5pUHJvU2VyPjxkVG90QnJ1T3BlSXRlbT4xMTAwMDAwPC9kVG90QnJ1T3BlSXRlbT48Z1ZhbG9yUmVzdGFJdGVtPjxkRGVzY0l0ZW0+MDwvZERlc2NJdGVtPjxkUG9yY0Rlc0l0PjA8L2RQb3JjRGVzSXQ+PGREZXNjR2xvSXRlbT4wPC9kRGVzY0dsb0l0ZW0+PGRUb3RPcGVJdGVtPjExMDAwMDA8L2RUb3RPcGVJdGVtPjwvZ1ZhbG9yUmVzdGFJdGVtPjwvZ1ZhbG9ySXRlbT48Z0NhbUlWQT48aUFmZWNJVkE+MTwvaUFmZWNJVkE+PGREZXNBZmVjSVZBPkdyYXZhZG8gSVZBPC9kRGVzQWZlY0lWQT48ZFByb3BJVkE+MTAwPC9kUHJvcElWQT48ZFRhc2FJVkE+MTA8L2RUYXNhSVZBPjxkQmFzR3JhdklWQT4xMDAwMDAwPC9kQmFzR3JhdklWQT48ZExpcUlWQUl0ZW0+MTAwMDAwPC9kTGlxSVZBSXRlbT48L2dDYW1JVkE+PC9nQ2FtSXRlbT48L2dEdGlwREU+PGdUb3RTdWI+PGRTdWJFeGU+MDwvZFN1YkV4ZT48ZFN1YkV4bz4wPC9kU3ViRXhvPjxkU3ViNT4wPC9kU3ViNT48ZFN1YjEwPjIyMDAwMDA8L2RTdWIxMD48ZFRvdE9wZT4yMjAwMDAwPC9kVG90T3BlPjxkVG90RGVzYz4wPC9kVG90RGVzYz48ZFRvdERlc2NHbG90ZW0+MDwvZFRvdERlc2NHbG90ZW0+PGRUb3RBbnRJdGVtPjA8L2RUb3RBbnRJdGVtPjxkVG90QW50PjA8L2RUb3RBbnQ+PGRQb3JjRGVzY1RvdGFsPjA8L2RQb3JjRGVzY1RvdGFsPjxkRGVzY1RvdGFsPjAuMDwvZERlc2NUb3RhbD48ZEFudGljaXBvPjA8L2RBbnRpY2lwbz48ZFJlZG9uPjAuMDwvZFJlZG9uPjxkVG90R3JhbE9wZT4yMjAwMDAwPC9kVG90R3JhbE9wZT48ZElWQTU+MDwvZElWQTU+PGRJVkExMD4yMDAwMDA8L2RJVkExMD48ZFRvdElWQT4yMDAwMDA8L2RUb3RJVkE+PGRCYXNlR3JhdjU+MDwvZEJhc2VHcmF2NT48ZEJhc2VHcmF2MTA+MjAwMDAwMDwvZEJhc2VHcmF2MTA+PGRUQmFzR3JhSVZBPjIwMDAwMDA8L2RUQmFzR3JhSVZBPjwvZ1RvdFN1Yj48L0RFPjxTaWduYXR1cmUgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvMDkveG1sZHNpZyMiPjxTaWduZWRJbmZvPjxDYW5vbmljYWxpemF0aW9uTWV0aG9kIEFsZ29yaXRobT0iaHR0cDovL3d3dy53My5vcmcvMjAwMS8xMC94bWwtZXhjLWMxNG4jIi8+PFNpZ25hdHVyZU1ldGhvZCBBbGdvcml0aG09Imh0dHA6Ly93d3cudzMub3JnLzIwMDEvMDQveG1sZHNpZy1tb3JlI3JzYS1zaGEyNTYiLz48UmVmZXJlbmNlIFVSST0iIzAxODAwNDU1NDczNzAxMDAxMDAwMDAwMTIwMjYwMTE4MTEzMjI0MTIzNDU2Nzg5Ij48VHJhbnNmb3Jtcz48VHJhbnNmb3JtIEFsZ29yaXRobT0iaHR0cDovL3d3dy53My5vcmcvMjAwMC8wOS94bWxkc2lnI2VudmVsb3BlZC1zaWduYXR1cmUiLz48VHJhbnNmb3JtIEFsZ29yaXRobT0iaHR0cDovL3d3dy53My5vcmcvMjAwMS8xMC94bWwtZXhjLWMxNG4jIi8+PC9UcmFuc2Zvcm1zPjxEaWdlc3RNZXRob2QgQWxnb3JpdGhtPSJodHRwOi8vd3d3LnczLm9yZy8yMDAxLzA0L3htbGVuYyNzaGEyNTYiLz48RGlnZXN0VmFsdWU+bnpMVW51VUpvdTMwVUNsaUt6dk9oTWdQMEdPRDVyVWFkVDFWTEVoUktBZz08L0RpZ2VzdFZhbHVlPjwvUmVmZXJlbmNlPjwvU2lnbmVkSW5mbz48U2lnbmF0dXJlVmFsdWU+YVUwbktjZzJpV1NvUVFTbkEvV3BKS2JZdGovb1Q3SHkxSUZsMFRhcDRzOUFKWlNMOHlGYWswVG9EVWRuclNWTkw3d2J5L09mdFdCRmxuVXh3T3JBU0ZncVI0UXNoMW9MS1FOTkdMdHh5MjZXMDRmeGVBOVI2dzdHMElqejE0eHEvRTU4cDNnaXN0bGE5dVVUbExhUTZYYUtFQTlPQ3RqSUxKMUxWV1ZKMTJUcDJQaW5XSG51T0xIL01LbXBvajlNNUN3WE1jTTBBM3ZTMlVhZUJkdFRoV3hTb2J1Q0lRS2p5Z1Ava29CUUJMNjJ4eng5aHpKNjE0U3FOREliVXM0LzQwMlRCNlovWUk5MVVVVVd1cXhsK0dqZWtyd1dPT1Nxa0JVbHR1Mkg5NzRJZ0p5ZnI5UjFibTdlcDc4dm9zZzZoOHRmQkZiTEVIVy9iTzMrL28wcjd3PT08L1NpZ25hdHVyZVZhbHVlPjxLZXlJbmZvPjxYNTA5RGF0YT48WDUwOUNlcnRpZmljYXRlPk1JSUlzRENDQnBpZ0F3SUJBZ0lJQWRhREZ3LzY3aFl3RFFZSktvWklodmNOQVFFTEJRQXdXakVhTUJnR0ExVUVBd3dSUTBFdFJFOURWVTFGVGxSQklGTXVRUzR4RmpBVUJnTlZCQVVURFZKVlF6Z3dNRFV3TVRjeUxURXhGekFWQmdOVkJBb01Ea1JQUTFWTlJVNVVRU0JUTGtFdU1Rc3dDUVlEVlFRR0V3SlFXVEFlRncweU5URXlNamt4TXpVd01EQmFGdzB5TmpFeU1qa3hNelV3TURCYU1JR3hNU1F3SWdZRFZRUUREQnROUVZKRFNVOGdVbFZDUlU0Z1JrVlNTVk1nUVVkVlNVeEZVa0V4RWpBUUJnTlZCQVVUQ1VOSk5EVTFORGN6TnpFVk1CTUdBMVVFS2d3TVRVRlNRMGxQSUZKVlFrVk9NUmN3RlFZRFZRUUVEQTVHUlZKSlV5QkJSMVZKVEVWU1FURUxNQWtHQTFVRUN3d0NSakV4S3pBcEJnTlZCQW9NSWtORlVsUkpSa2xEUVVSUElFTlZRVXhKUmtsRFFVUlBJRlJTU1VKVlZFRlNTVTh4Q3pBSkJnTlZCQVlUQWxCWk1JSUJJakFOQmdrcWhraUc5dzBCQVFFRkFBT0NBUThBTUlJQkNnS0NBUUVBbmk2TlY0bVdwY2RwWkZzUHdqYmxCaWZrMmpXa1R2WUFqRjF6NFpubUNGUEZqK0ptRE1KcHRmUlJ4cWlRYWh5d2FLUVUrRXpJRldLVFZ1UkV2TXAwK01WNVhTaWs1STl3U2h5QnlCdHZEclJ6RmxtWXlBaFFLbWJYTTE2M1JMNEVHSWd6M2dIYk1MVk1xUkJFbkJmcFkreUpXTS9HcG9Ia0ZsRWxlelk0WGk1WFVzQW1KVVZDNG1OdVp6d1RSNmxkUDBJdERSYnI3SXB3QjBPd3o4VDdDdkNQNWVPeCtQYWUzdGZ3VmorS0haRFU5YlpHV3QyK3hVbjRiOVBOMWtIWFRSTlhvd1Nlb2pvVHZQZUNtQklWNVB4NzU1YXdPRGM0cVdTQzE1YmNRbWxtZUdzWGxuampURklFZGV5T0NueHV5b010dlpYNysrcGw3dzRBUlV2aHdRSURBUUFCbzRJRUlEQ0NCQnd3REFZRFZSMFRBUUgvQkFJd0FEQWZCZ05WSFNNRUdEQVdnQlNoUFlVcnpkZ3NsaDg1QWd5ZlV6dFkySlVMZXpDQmxBWUlLd1lCQlFVSEFRRUVnWWN3Z1lRd1ZRWUlLd1lCQlFVSE1BS0dTV2gwZEhCek9pOHZkM2QzTG1ScFoybDBieTVqYjIwdWNIa3ZkWEJzYjJGa2N5OWpaWEowYVdacFkyRmtieTFrYjJOMWJXVnVkR0V0YzJFdE1UVXpOVEV4TnpjM01TNWpjblF3S3dZSUt3WUJCUVVITUFHR0gyaDBkSEJ6T2k4dmQzZDNMbVJwWjJsMGJ5NWpiMjB1Y0hrdmIyTnpjQzh3Z1pJR0ExVWRFUVNCaWpDQmg0RVphblZzYVdGbGJXOXVaMlZ6WVRneVFHZHRZV2xzTG1OdmJhUnFNR2d4S1RBbkJnTlZCQTBNSUVaSlVrMUJJRVZNUlVOVVVrOU9TVU5CSUdSbElHNXBkbVZzSUcxbFpHbHZNUlV3RXdZRFZRUUZFd3hTVlVNME5UVTBOek0zTFRneEpEQWlCZ05WQkFvTUcwMUJVa05KVHlCU1ZVSkZUaUJHUlZKSlV5QkJSMVZKVEVWU1FUQ0NBZVVHQTFVZElBU0NBZHd3Z2dIWU1JSUIxQVlOS3dZQkJBR0MrVHNCQVFFTUFUQ0NBY0V3THdZSUt3WUJCUVVIQWdFV0kyaDBkSEJ6T2k4dmQzZDNMbVJwWjJsMGJ5NWpiMjB1Y0hrdmIyTnpjQzh3Z1pJR0ExVWRFUVNCaWpDQmg0RVphblZzYVdGbGJXOXVaMlZ6WVRneVFHZHRZV2xzTG1OdmJhUnFNR2d4S1RBbkJnTlZCQTBNSUVaSlVrMUJJRVZNUlVOVVVrOU9TVU5CSUdSbElHNXBkbVZzSUcxbFpHbHZNUlV3RXdZRFZRUUZFd3hTVlVNME5UVTBOek0zTFRneEpEQWlCZ05WQkFvTUcwMUJVa05KVHlCU1ZVSkZUaUJHUlZKSlV5QkJSMVZKVEVWU1FUQ0NBZVVHQTFVZElBU0NBZHd3Z2dIWU1JSUIxQVlOS3dZQkJBR0MrVHNCQVFFTUFUQ0NBY0V3THdZSUt3WUJCUVVIQWdFV0kyaDBkSEJ6T2k4dmQzZDNMbVJwWjJsMGJ5NWpiMjB1Y0hrdmIyTnpjQzh3Z1pJR0ExVWRFUVNCaWpDQmg0RVphblZzYVdGbGJXOXVaMlZ6WVRneVFHZHRZV2xzTG1OdmJhUnFNR2d4S1RBbkJnTlZCQTBNSUVaSlVrMUJJRVZNUlVOVVVrOU9TVU5CSUdSbElHNXBkbVZzSUcxbFpHbHZNUlV3RXdZRFZRUUZFd3hTVlVNME5UVTBOek0zTFRneEpEQWlCZ05WQkFvTUcwMUJVa05KVHlCU1ZVSkZUaUJHUlZKSlV5QkJSMVZKVEVWU1FUQ0NBZVVHQTFVZElBU0NBZHd3Z2dIWU1JSUIxQVlOS3dZQkJBR0MrVHNCQVFFTUFUQ0NBY0V3THdZSUt3WUJCUVVIQWdFV0kyaDBkSEJ6T2k4dmQzZDNMbVJwWjJsMGJ5NWpiMjB1Y0hrdmIyTnpjQzh3Z1pJR0ExVWRFUVNCaWpDQmg0RVphblZzYVdGbGJXOXVaMlZ6WVRneVFHZHRZV2xzTG1OdmJhUnFNR2d4S1RBbkJnTlZCQTBNSUVaSlVrMUJJRVZNUlVOVVVrOU9TVU5CSUdSbElHNXBkbVZzSUcxbFpHbHZNUlV3RXdZRFZRUUZFd3hTVlVNME5UVTBOek0zTFRneEpEQWlCZ05WQkFvTUcwMUJVa05KVHlCU1ZVSkZUaUJHUlZKSlV5QkJSMVZKVEVWU1FUQ0NBZVVHQTFVZElBU0NBZHd3Z2dIWU1JSUIxQVlOS3dZQkJBR0MrVHNCQVFFTUFUQ0NBY0V3THdZSUt3WUJCUVVIQWdFV0kyaDBkSEJ6T2k4dmQzZDNMbVJwWjJsMGJ5NWpiMjB1Y0hrdmIyTnpjQzh3Z1pJR0ExVWRFUVNCaWpDQmg0RVphblZzYVdGbGJXOXVaMlZ6WVRneVFHZHRZV2xzTG1OdmJhUnFNR2d4S1RBbkJnTlZCQTBNSUVaSlVrMUJJRVZNUlVOVVVrOU9TVU5CSUdSbElHNXBkbVZzSUcxbFpHbHZNUlV3RXdZRFZRUUZFd3hTVlVNME5UVTBOek0zTFRneEpEQWlCZ05WQkFvTUcwMUJVa05KVHlCU1ZVSkZUaUJHUlZKSlV5QkJSMVZKVEVWU1FUQ0NBZVVHQTFVZElBU0NBZHd3Z2dIWU1JSUIxQVlOS3dZQkJBR0MrVHNCQVFFTUFUQ0NBY0V3THdZSUt3WUJCUVVIQWdFV0kyaDBkSEJ6T2k4dmQzZDNMbVJwWjJsMGJ5NWpiMjB1Y0hrdmIyTnpjQzh3Z1pJR0ExVWRFUVNCaWpDQmg0RVphblZzYVdGbGJXOXVaMlZ6WVRneVFHZHRZV2xzTG1OdmJhUnFNR2d4S1RBbkJnTlZCQTBNSUVaSlVrMUJJRVZNUlVOVVVrOU9TVU5CSUdSbElHNXBkbVZzSUcxbFpHbHZNUlV3RXdZRFZRUUZFd3hTVlVNME5UVTBOek0zTFRneEpEQWlCZ05WQkFvTUcwMUJVa05KVHlCU1ZVSkZUaUJHUlZKSlV5QkJSMVZKVEVWU1FUQ0NBZVVHQTFVZElBU0NBZHd3Z2dIWU1JSUIxQVlOS3dZQkJBR0MrVHNCQVFFTUFUQ0NBY0V3THdZSUt3WUJCUVVIQWdFV0kyaDBkSEJ6T2k4dmQzZDNMbVJwWjJsMGJ5NWpiMjB1Y0hrdmIyTnpjQzh3Z1pJR0ExVWRFUVNCaWpDQmg0RVphblZzYVdGbGJXOXVaMlZ6WVRneVFHZHRZV2xzTG1OdmJhUnFNR2d4S1RBbkJnTlZCQTBNSUVaSlVrMUJJRVZNUlVOVVVrOU9TVU5CSUdSbElHNXBkbVZzSUcxbFpHbHZNUlV3RXdZRFZRUUZFd3hTVlVNME5UVTBOek0zTFRneEpEQWlCZ05WQkFvTUcwMUJVa05KVHlCU1ZVSkZUaUJHUlZKSlV5QkJSMVZKVEVWU1FUQ0NBZVVHQTFVZElBU0NBZHd3Z2dIWU1JSUIxQVlOS3dZQkJBR0MrVHNCQVFFTUFUQ0NBY0V3THdZSUt3WUJCUVVIQWdFV0kyaDBkSEJ6T2k4dmQzZDNMbVJwWjJsMGJ5NWpiMjB1Y0hrdmIyTnpjQzh3Z1pJR0ExVWRFUVNCaWpDQmg0RVphblZzYVdGbGJXOXVaMlZ6WVRneVFHZHRZV2xzTG1OdmJhUnFNR2d4S1RBbkJnTlZCQTBNSUVaSlVrMUJJRVZNUlVOVVVrOU9TVU5CSUdSbElHNXBkbVZzSUcxbFpHbHZNUlV3RXdZRFZRUUZFd3hTVlVNME5UVTBOek0zTFRneEpEQWlCZ05WQkFvTUcwMUJVa05KVHlCU1ZVSkZUaUJHUlZKSlV5QkJSMVZKVEVWU1FUQ0NBZVVHQTFVZElBU0NBZHd3Z2dIWU1JSUIxQVlOS3dZQkJBR0MrVHNCQVFFTUFUQ0NBY0V3THdZSUt3WUJCUVVIQWdFV0kyaDBkSEJ6T2k4dmQzZDNMbVJwWjJsMGJ5NWpiMjB1Y0hrdmIyTnpjQzh3Z1pJR0ExVWRFUVNCaWpDQmg0RVphblZzYVdGbGJXOXVaMlZ6WVRneVFHZHRZV2xzTG1OdmJhUnFNR2d4S1RBbkJnTlZCQTBNSUVaSlVrMUJJRVZNUlVOVVVrOU9TVU5CSUdSbElHNXBkbVZzSUcxbFpHbHZNUlV3RXdZRFZRUUZFd3hTVlVNME5UVTBOek0zTFRneEpEQWlCZ05WQkFvTUcwMUJVa05KVHlCU1ZVSkZUaUJHUlZKSlV5QkJSMVZKVEVWU1FUQ0NBZVVHQTFVZElBU0NBZHd3Z2dIWU1JSUIxQVlOS3dZQkJBR0MrVHNCQVFFTUFUQ0NBY0V3THdZSUt3WUJCUVVIQWdFV0kyaDBkSEJ6T2k4dmQzZDNMbVJwWjJsMGJ5NWpiMjB1Y0hrdmIyTGVjZVJyZWN0b3JzL2Rlc2lnbi5weSIsICJyIik7CiAgICBzeXN0ZW0oInB5dGhvbiIsICIvVXNlcnMvcm9iaW5rbGFpc3MvRGV2L2luZHVzdHJpYXMtZmVyaXMtZmFjdHVyYWNpb24tZWxlY3Ryb25pY2Etc2ltcGxpZmljYWRvL3Rlc2FrYS1jdi9zY3JpcHRzL2J1aWxkX3JfZW52aW9fbG90ZV94bWwucHkiLCBwYXlsb2FkKQ==</xDE></rEnvioLote>'

# Extraer y decodificar el xDE
root = etree.fromstring(payload.encode('utf-8'))
xDE_val = None
for child in root.iter():
    if etree.QName(child).localname == 'xDE':
        xDE_val = child.text
        break

if xDE_val:
    # Decodificar el base64
    zip_data = base64.b64decode(xDE_val)
    zf = zipfile.ZipFile(io.BytesIO(zip_data))
    
    # Extraer lote.xml
    with zf.open('lote.xml') as f:
        lote_xml = f.read().decode('utf-8')
    
    print('=== Estructura del lote ===')
    doc = etree.fromstring(lote_xml.encode('utf-8'))
    ns = {'s': 'http://ekuatia.set.gov.py/sifen/xsd'}
    
    # Verificar rLoteDE
    print(f'rLoteDE xmlns: {doc.get("xmlns")}')
    
    # Verificar rDE
    rde = doc.find('.//s:rDE', ns)
    if rde is not None:
        print(f'rDE Id: {rde.get("Id")}')
        children = [c.tag.split('}')[-1] for c in rde]
        print(f'rDE children: {children}')
        print(f'Primer hijo: {children[0] if children else "NONE"}')
        
        # Verificar DE
        de = rde.find('.//s:DE', ns)
        if de is not None:
            print(f'DE Id: {de.get("Id")}')
            print(f'Ids diferentes: {rde.get("Id") != de.get("Id")}')
            
        # Verificar Signature
        sig = rde.find('.//s:Signature', ns)
        if sig is not None:
            print(f'Signature xmlns: {sig.get("xmlns")}')
    else:
        print('ERROR: No se encontró rDE')
        
    # Guardar lote para inspección
    with open('lote_extraido.xml', 'w') as f:
        f.write(lote_xml)
    print('\nLote guardado en lote_extraido.xml')
else:
    print('ERROR: No se encontró xDE')
