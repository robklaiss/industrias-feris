    <!DOCTYPE HTML>
    <html>
     <head>
      <meta http-equiv="content-type" content="text/html; charset=UTF-8">
      <style>
        .navbar__local {
          flex-grow: 1;
          display: grid;
          grid-auto-flow: column;
          grid-auto-columns: 1fr min-content 1fr;
          margin: 0;
          height: 100%;
          
          .navbar__item {
            align-content: center;
          }
          .navbar__link {
            display: inline;
          }
          .search {
            text-align: center;
          }
          .next {
            text-align: right;
          }
        }
      </style>
      <title>Recursive patterns</title>
      <link media="all" rel="stylesheet" type="text/css" href="styles/03e73060321a0a848018724a6c83de7f-theme-base.css" />
<link media="all" rel="stylesheet" type="text/css" href="styles/03e73060321a0a848018724a6c83de7f-theme-medium.css" />

     </head>
     <body class="docs">    <div class="navbar navbar-fixed-top">
      <div class="navbar__inner clearfix">
          <ul class="navbar__local">
            <li class="navbar__item prev"><a href="regexp.reference.comments.html" class="navbar__link">« Comments</a></li>
            <li class="navbar__item search">
              <!-- Desktop encanced search -->
              <button
                id="navbar__search-button"
                class="navbar__search-button"
                hidden
              >
                    <svg
        xmlns="http://www.w3.org/2000/svg"
        aria-hidden="true"
        width="24"
        viewBox="0 0 24 24"
        fill="none"
        stroke="currentColor"
        stroke-width="2"
        stroke-linecap="round"
        stroke-linejoin="round"
    >
    <circle cx="11" cy="11" r="8"></circle>
    <line x1="21" y1="21" x2="16.65" y2="16.65"></line>
    </svg>
                Search
              </button>
            </li>
            <li class="navbar__item next"><a href="regexp.reference.performance.html" class="navbar__link">Performance »</a></li>
          </ul>
      </div>
    </div>    <div id="breadcrumbs" class="clearfix">
      <ul class="breadcrumbs-container">
        <li><a href="index.html">PHP Manual</a></li>
        <li><a href="reference.pcre.pattern.syntax.html">PCRE regex syntax</a></li>
        <li>Recursive patterns</li>
      </ul>
    </div>    <div id="layout">
      <div id="layout-content"><div id="regexp.reference.recursive" class="section">
  <h2 class="title">Recursive patterns</h2>
  <p class="para">
   Consider the problem of matching a string in parentheses,
   allowing for unlimited nested parentheses. Without the use
   of recursion, the best that can be done is to use a pattern
   that matches up to some fixed depth of nesting. It is not
   possible to handle an arbitrary nesting depth. Perl 5.6 has
   provided an experimental facility that allows regular
   expressions to recurse (among other things). The special
   item (?R) is provided for the specific case of recursion.
   This PCRE pattern solves the parentheses problem (assume
   the <a href="reference.pcre.pattern.modifiers.html" class="link">PCRE_EXTENDED</a>
   option is set so that white space is
   ignored):

   <code class="literal">\( ( (?&gt;[^()]+) | (?R) )* \)</code>
  </p>
  <p class="para">
   First it matches an opening parenthesis. Then it matches any
   number of substrings which can either be a sequence of
   non-parentheses, or a recursive match of the pattern itself
   (i.e. a correctly parenthesized substring). Finally there is
   a closing parenthesis.
  </p>
  <p class="para">
   This particular example pattern contains nested unlimited
   repeats, and so the use of a once-only subpattern for matching
   strings of non-parentheses is important when applying
   the pattern to strings that do not match. For example, when
   it is applied to

   <code class="literal">(aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa()</code>

   it yields &quot;no match&quot; quickly. However, if a once-only subpattern
   is not used, the match runs for a very long time
   indeed because there are so many different ways the + and *
   repeats can carve up the subject, and all have to be tested
   before failure can be reported.
  </p>
  <p class="para">
   The values set for any capturing subpatterns are those from
   the outermost level of the recursion at which the subpattern
   value is set. If the pattern above is matched against

   <code class="literal">(ab(cd)ef)</code>

   the value for the capturing parentheses is &quot;ef&quot;, which is
   the last value taken on at the top level. If additional
   parentheses are added, giving

   <code class="literal">\( ( ( (?&gt;[^()]+) | (?R) )* ) \)</code>
   then the string they capture
   is &quot;ab(cd)ef&quot;, the contents of the top level parentheses. If
   there are more than 15 capturing parentheses in a pattern,
   PCRE has to obtain extra memory to store data during a
   recursion, which it does by using pcre_malloc, freeing it
   via pcre_free afterwards. If no memory can be obtained, it
   saves data for the first 15 capturing parentheses only, as
   there is no way to give an out-of-memory error from within a
   recursion.
  </p>

  <p class="para">
   <code class="literal">(?1)</code>, <code class="literal">(?2)</code> and so on
   can be used for recursive subpatterns too. It is also possible to use named
   subpatterns: <code class="literal">(?P&gt;name)</code> or
   <code class="literal">(?&amp;name)</code>.
  </p>
  <p class="para">
   If the syntax for a recursive subpattern reference (either by number or
   by name) is used outside the parentheses to which it refers, it operates
   like a subroutine in a programming language. An earlier example
   pointed out that the pattern
   <code class="literal">(sens|respons)e and \1ibility</code>
   matches &quot;sense and sensibility&quot; and &quot;response and responsibility&quot;, but
   not &quot;sense and responsibility&quot;. If instead the pattern
   <code class="literal">(sens|respons)e and (?1)ibility</code>
   is used, it does match &quot;sense and responsibility&quot; as well as the other
   two strings. Such references must, however, follow the subpattern to
   which they refer.
  </p>

  <p class="para">
   The maximum length of a subject string is the largest positive number
   that an integer variable can hold. However, PCRE uses recursion to
   handle subpatterns and indefinite repetition. This means that the
   available stack space may limit the size of a subject string that can be
   processed by certain patterns.
  </p>

 </div></div></div><script type="text/javascript" src="search-combined.js"></script><script type="text/javascript" src="js/67ae199ee27cc87120cab9ba49d1b776-FuzzySearch.min.js"></script><script type="text/javascript" src="js/f5555778cd757f2cb49676062898832b-search.js"></script>    <div id="search-modal__backdrop" class="search-modal__backdrop">
      <div
        role="dialog"
        aria-label="Search modal"
        id="search-modal"
        class="search-modal"
      >
        <div class="search-modal__header">
          <div class="search-modal__form">
            <div class="search-modal__input-icon">
              <!-- https://feathericons.com search -->
              <svg xmlns="http://www.w3.org/2000/svg"
                aria-hidden="true"
                width="24"
                viewBox="0 0 24 24"
                fill="none"
                stroke="currentColor"
                stroke-width="2"
                stroke-linecap="round"
                stroke-linejoin="round"
              >
                <circle cx="11" cy="11" r="8"></circle>
                <line x1="21" y1="21" x2="16.65" y2="16.65"></line>
              </svg>
            </div>
            <input
              type="search"
              id="search-modal__input"
              class="search-modal__input"
              placeholder="Search docs"
              aria-label="Search docs"
            />
          </div>
    
          <button aria-label="Close" class="search-modal__close">
            <!-- https://pictogrammers.com/library/mdi/icon/close/ -->
            <svg
              xmlns="http://www.w3.org/2000/svg"
              aria-hidden="true"
              width="24"
              viewBox="0 0 24 24"
            >
              <path d="M19,6.41L17.59,5L12,10.59L6.41,5L5,6.41L10.59,12L5,17.59L6.41,19L12,13.41L17.59,19L19,17.59L13.41,12L19,6.41Z"/>
            </svg>
          </button>
        </div>
        <div
          role="listbox"
          aria-label="Search results"
          id="search-modal__results"
          class="search-modal__results"
        ></div>
        <div class="search-modal__helper-text">
          <div>
            <kbd>↑</kbd> and <kbd>↓</kbd> to navigate •
            <kbd>Enter</kbd> to select •
            <kbd>Esc</kbd> to close • <kbd>/</kbd> to open
          </div>
        </div>
      </div>
    </div>
    <script type="text/javascript">
        document.addEventListener("DOMContentLoaded", function() {
            /*{{{Search Modal*/
            const language = 'local';
            initSearchModal();
            initPHPSearch(language).then((searchCallback) => {
                initSearchUI({language, searchCallback, limit: 30});
            });
            /*}}}*/
        });
    </script></body></html>