#!/usr/bin/env python3
"""
Genera XML mínimo basado en el XML validado
"""

from lxml import etree
from pathlib import Path

# Cargar XML original
template_path = Path("../docs/fac_029-010-0189456_533750241.xml_01800140664029010018945612026010915677380320.xml")
parser = etree.XMLParser(remove_blank_text=False)
tree = etree.parse(template_path, parser)
root = tree.getroot()

SIFEN_NS = "{http://ekuatia.set.gov.py/sifen/xsd}"

# Extraer rDE
rde = root.find(f".//{SIFEN_NS}rDE")

# Cambiar solo lo esencial del emisor
gEmis = rde.find(f".//{SIFEN_NS}gEmis")
gEmis.find(f"{SIFEN_NS}dRucEm").text = "4554737"
gEmis.find(f"{SIFEN_NS}dDVEmi").text = "8"
gEmis.find(f"{SIFEN_NS}dNomEmi").text = "EMPRESA DE PRUEBA S.A."
gEmis.find(f"{SIFEN_NS}dNomFanEmi").text = "EMPRESA DE PRUEBA"
gEmis.find(f"{SIFEN_NS}dDirEmi").text = "DIRECCION DE PRUEBA 123"

# Cambiar timbrado
gTimb = rde.find(f".//{SIFEN_NS}gTimb")
gTimb.find(f"{SIFEN_NS}dNumTim").text = "12345678"
gTimb.find(f"{SIFEN_NS}dEst").text = "001"
gTimb.find(f"{SIFEN_NS}dPunExp").text = "001"
gTimb.find(f"{SIFEN_NS}dNumDoc").text = "0000003"

# Guardar
output_path = Path("mi_factura_minima.xml")
xml_bytes = etree.tostring(rde, encoding='utf-8', xml_declaration=True, standalone=False)
output_path.write_bytes(xml_bytes)

print(f"✅ XML guardado: {output_path}")
