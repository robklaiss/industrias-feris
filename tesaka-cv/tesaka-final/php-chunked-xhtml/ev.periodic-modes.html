    <!DOCTYPE HTML>
    <html>
     <head>
      <meta http-equiv="content-type" content="text/html; charset=UTF-8">
      <style>
        .navbar__local {
          flex-grow: 1;
          display: grid;
          grid-auto-flow: column;
          grid-auto-columns: 1fr min-content 1fr;
          margin: 0;
          height: 100%;
          
          .navbar__item {
            align-content: center;
          }
          .navbar__link {
            display: inline;
          }
          .search {
            text-align: center;
          }
          .next {
            text-align: right;
          }
        }
      </style>
      <title>Periodic watcher operation modes</title>
      <link media="all" rel="stylesheet" type="text/css" href="styles/03e73060321a0a848018724a6c83de7f-theme-base.css" />
<link media="all" rel="stylesheet" type="text/css" href="styles/03e73060321a0a848018724a6c83de7f-theme-medium.css" />

     </head>
     <body class="docs">    <div class="navbar navbar-fixed-top">
      <div class="navbar__inner clearfix">
          <ul class="navbar__local">
            <li class="navbar__item prev"><a href="ev.watcher-callbacks.html" class="navbar__link">« Watcher callbacks</a></li>
            <li class="navbar__item search">
              <!-- Desktop encanced search -->
              <button
                id="navbar__search-button"
                class="navbar__search-button"
                hidden
              >
                    <svg
        xmlns="http://www.w3.org/2000/svg"
        aria-hidden="true"
        width="24"
        viewBox="0 0 24 24"
        fill="none"
        stroke="currentColor"
        stroke-width="2"
        stroke-linecap="round"
        stroke-linejoin="round"
    >
    <circle cx="11" cy="11" r="8"></circle>
    <line x1="21" y1="21" x2="16.65" y2="16.65"></line>
    </svg>
                Search
              </button>
            </li>
            <li class="navbar__item next"><a href="class.ev.html" class="navbar__link">Ev »</a></li>
          </ul>
      </div>
    </div>    <div id="breadcrumbs" class="clearfix">
      <ul class="breadcrumbs-container">
        <li><a href="index.html">PHP Manual</a></li>
        <li><a href="book.ev.html">Ev</a></li>
        <li>Periodic watcher operation modes</li>
      </ul>
    </div>    <div id="layout">
      <div id="layout-content"><div id="ev.periodic-modes" class="chapter">
 <h1 class="title">Periodic watcher operation modes</h1>

 <p class="simpara">
  <span class="classname"><a href="class.evperiodic.html" class="classname">EvPeriodic</a></span>
  watcher works in different modes depending on the
  <code class="parameter">offset</code>,
  <code class="parameter">interval</code>
  and
  <code class="parameter">reschedule_cb</code>
  parameters.
 </p>
 <ol type="1">
  <li class="listitem">
   <span class="simpara">
    <em>Absolute timer</em>.
    In this mode
    <code class="parameter">interval</code>
    =
    <code class="literal">0</code>,
    <code class="parameter">reschedule_cb</code>
    = <strong><code><a href="reserved.constants.html#constant.null">null</a></code></strong>. This time simply fires at the wallclock time
    <code class="parameter">offset</code>
    and doesn&#039;t repeat. It will not adjust when a time jump occurs, that is,
    if it is to be run at
    <em>January
   1st 2014</em>
    then it will run when the system time reaches or surpasses this time.
   </span>
  </li>
  <li class="listitem">
   <span class="simpara">
    <em>Repeating interval timer</em>.
    In this mode
    <code class="parameter">interval</code>
    &gt;
    <code class="literal">0</code>,
    <code class="parameter">reschedule_cb</code>
    = <strong><code><a href="reserved.constants.html#constant.null">null</a></code></strong>; the watcher will always be scheduled to timeout at the next
    <code class="parameter">offset</code>
    +
    <strong><code>N</code></strong>
    *
    <code class="parameter">interval</code>
    time(for some integer
    <strong><code>N</code></strong>)
    and then repeat, regardless of any time jumps.
   </span>
   <p class="para">
    This can be used to create timers that do not drift with respect to system
    time:
    <div class="example-contents">
<div class="phpcode"><code><span style="color: #000000"><span style="color: #0000BB">&lt;?php<br />$hourly </span><span style="color: #007700">= </span><span style="color: #0000BB">EvPeriodic</span><span style="color: #007700">(</span><span style="color: #0000BB">0</span><span style="color: #007700">, </span><span style="color: #0000BB">3600</span><span style="color: #007700">, </span><span style="color: #0000BB">NULL</span><span style="color: #007700">, function () {<br />  echo </span><span style="color: #DD0000">"once per hour\n"</span><span style="color: #007700">;<br />});<br /></span><span style="color: #0000BB">?&gt;</span></span></code></div>
    </div>

    That doesn&#039;t mean there will always be
    <code class="literal">3600</code>
    seconds in between triggers, but only that the callback will be called
    when the system time shows a full hour(
    <em>UTC</em>
    ).
   </p>
   <span class="simpara">
    <span class="classname"><a href="class.evperiodic.html" class="classname">EvPeriodic</a></span>
    will try to run the callback in this mode at the next possible time where
    <var class="varname">time</var>
    =
    <code class="parameter">offset</code>
    (
    <code class="literal">mod</code>
    <code class="parameter">interval</code>
    ), regardless of any time jumps.
   </span>
  </li>
  <li class="listitem">
   <span class="simpara">
    <em>Manual reschedule mode</em>.
    In this mode
    <code class="parameter">reschedule_cb</code>
    is a
    <span class="type"><a href="language.types.callable.html" class="type callable">callable</a></span>.
   </span>
   <span class="simpara">
    <code class="parameter">interval</code>
    and
    <code class="parameter">offset</code>
    are both being ignored. Instead, each time the periodic watcher gets
    scheduled, the reschedule callback (
    <code class="parameter">reschedule_cb</code>)
    will be called with the watcher as first, and the current time as second
    argument.
   </span>
   <span class="simpara">
    This callback
    <em>must not</em>
    stop or destroy this or any other periodic watchers, ever, and
    <em>must not</em>
    call any event loop functions or methods. To stop it return
    <code class="literal">1e30</code>
    and stop it afterwards. An
    <span class="classname"><a href="class.evprepare.html" class="classname">EvPrepare</a></span>
    watcher may be used for this task.
   </span>
   <span class="simpara">
    It must return the next time to trigger, based on the passed time value
    (that is, the lowest time value larger than or equal to the second
    argument). It will usually be called just before the callback will be
    triggered, but might be called at other times, too.
   </span>
   <div class="example" id="example-1">
    <p><strong>Example #1 Using reschedule callback</strong></p>
    <div class="example-contents">
<div class="phpcode"><code><span style="color: #000000"><span style="color: #0000BB">&lt;?php<br /></span><span style="color: #FF8000">// Tick each 10.5 seconds<br /><br /></span><span style="color: #007700">function </span><span style="color: #0000BB">reschedule_cb </span><span style="color: #007700">(</span><span style="color: #0000BB">$watcher</span><span style="color: #007700">, </span><span style="color: #0000BB">$now</span><span style="color: #007700">) {<br />   return </span><span style="color: #0000BB">$now </span><span style="color: #007700">+ (</span><span style="color: #0000BB">10.5</span><span style="color: #007700">. - </span><span style="color: #0000BB">fmod</span><span style="color: #007700">(</span><span style="color: #0000BB">$now</span><span style="color: #007700">, </span><span style="color: #0000BB">10.5</span><span style="color: #007700">));<br />}<br /><br /></span><span style="color: #0000BB">$w </span><span style="color: #007700">= new </span><span style="color: #0000BB">EvPeriodic</span><span style="color: #007700">(</span><span style="color: #0000BB">0.</span><span style="color: #007700">, </span><span style="color: #0000BB">0.</span><span style="color: #007700">, </span><span style="color: #DD0000">"reschedule_cb"</span><span style="color: #007700">, function (</span><span style="color: #0000BB">$w</span><span style="color: #007700">, </span><span style="color: #0000BB">$revents</span><span style="color: #007700">) {<br />   echo </span><span style="color: #0000BB">time</span><span style="color: #007700">(), </span><span style="color: #0000BB">PHP_EOL</span><span style="color: #007700">;<br />});<br /><br /></span><span style="color: #0000BB">Ev</span><span style="color: #007700">::</span><span style="color: #0000BB">run</span><span style="color: #007700">();<br /></span><span style="color: #0000BB">?&gt;</span></span></code></div>
    </div>

   </div>
  </li>
 </ol>
</div>
</div></div><script type="text/javascript" src="search-combined.js"></script><script type="text/javascript" src="js/67ae199ee27cc87120cab9ba49d1b776-FuzzySearch.min.js"></script><script type="text/javascript" src="js/f5555778cd757f2cb49676062898832b-search.js"></script>    <div id="search-modal__backdrop" class="search-modal__backdrop">
      <div
        role="dialog"
        aria-label="Search modal"
        id="search-modal"
        class="search-modal"
      >
        <div class="search-modal__header">
          <div class="search-modal__form">
            <div class="search-modal__input-icon">
              <!-- https://feathericons.com search -->
              <svg xmlns="http://www.w3.org/2000/svg"
                aria-hidden="true"
                width="24"
                viewBox="0 0 24 24"
                fill="none"
                stroke="currentColor"
                stroke-width="2"
                stroke-linecap="round"
                stroke-linejoin="round"
              >
                <circle cx="11" cy="11" r="8"></circle>
                <line x1="21" y1="21" x2="16.65" y2="16.65"></line>
              </svg>
            </div>
            <input
              type="search"
              id="search-modal__input"
              class="search-modal__input"
              placeholder="Search docs"
              aria-label="Search docs"
            />
          </div>
    
          <button aria-label="Close" class="search-modal__close">
            <!-- https://pictogrammers.com/library/mdi/icon/close/ -->
            <svg
              xmlns="http://www.w3.org/2000/svg"
              aria-hidden="true"
              width="24"
              viewBox="0 0 24 24"
            >
              <path d="M19,6.41L17.59,5L12,10.59L6.41,5L5,6.41L10.59,12L5,17.59L6.41,19L12,13.41L17.59,19L19,17.59L13.41,12L19,6.41Z"/>
            </svg>
          </button>
        </div>
        <div
          role="listbox"
          aria-label="Search results"
          id="search-modal__results"
          class="search-modal__results"
        ></div>
        <div class="search-modal__helper-text">
          <div>
            <kbd>↑</kbd> and <kbd>↓</kbd> to navigate •
            <kbd>Enter</kbd> to select •
            <kbd>Esc</kbd> to close • <kbd>/</kbd> to open
          </div>
        </div>
      </div>
    </div>
    <script type="text/javascript">
        document.addEventListener("DOMContentLoaded", function() {
            /*{{{Search Modal*/
            const language = 'local';
            initSearchModal();
            initPHPSearch(language).then((searchCallback) => {
                initSearchUI({language, searchCallback, limit: 30});
            });
            /*}}}*/
        });
    </script></body></html>