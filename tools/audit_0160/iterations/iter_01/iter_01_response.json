{
  "returncode": 1,
  "stdout": "DEBUG: send_sirecepde_lote llamado con xml_file=/Users/robinklaiss/Dev/industrias-feris-facturacion-electronica-simplificado/tools/audit_0160/iterations/iter_01/iter_01_lote.xml\nDEBUG: XML le\u00eddo, longitud=5054\n\ud83d\udcc4 Cargando XML: /Users/robinklaiss/Dev/industrias-feris-facturacion-electronica-simplificado/tools/audit_0160/iterations/iter_01/iter_01_lote.xml\n\ud83d\udd0d STAGE 01_input: 5061 bytes, SHA256: 28c84ab0c9b89b7a392b8529981c265c7b6c71c8daa391471248463b48e839f0\n   \ud83d\udcbe Guardado: artifacts/_stage_01_input.xml\n   Tama\u00f1o: 5061 bytes (4.94 KB)\n\n\u2713 RUC del emisor validado (no es dummy)\n\n\ud83d\udd27 Configurando cliente SIFEN (ambiente: test)...\n   WSDL (recibe_lote): https://sifen-test.set.gov.py/de/ws/async/recibe-lote.wsdl?wsdl\n   Operaci\u00f3n: siRecepLoteDE\n\n\ud83d\udce6 Construyendo y firmando lote desde XML individual...\n\ud83d\udd10 Verificando si el XML ya est\u00e1 firmado...\n\u2713 XML ya est\u00e1 firmado, usando modo passthrough (sin re-serializaci\u00f3n)\n\ud83d\udd10 PASSTHROUGH: Detectado XML ya firmado, extrayendo rDE bytes sin re-serializar\nDEBUG: Signature en entrada a build_lote_passthrough_signed: <Signature xmlns=\"http://www.w3.org/2000/09/xmldsig#\"/>\n   rDE extra\u00eddo: 4987 bytes\nDEBUG: Signature en rDE extra\u00eddo: <Signature xmlns=\"http://www.w3.org/2000/09/xmldsig#\"/>\nDEBUG: Iniciando verificaci\u00f3n de rDE\n\u2705 rDE ya tiene Id: rDE01800455473701001000000120260118113104123456789\n   rDE actualizado con schemaLocation: 4987 bytes\n   rDE actualizado despu\u00e9s de limpiar gCamFuFD: 4987 bytes\n\ud83d\udd0d DEBUG rde_bytes length: 4987\n\ud83d\udd0d DEBUG rde_str2 starts with: <rDE xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" xmlns=\"http://ekuatia.set.gov.py/sifen/xs...\n\u2705 dCarQR ya presente en rDE (passthrough)\n\ud83d\udcbe Guardado: artifacts/_passthrough_rde_input.xml\n   lote.xml construido: 5088 bytes\n\u2705 Verificaci\u00f3n OK: rDE presente en lote.xml\n\ud83d\udcbe Guardado: artifacts/_passthrough_lote.xml\n\u2713 Lote construido con rDE firmado intacto\n\n\u26a0\ufe0f  Error al validar XSD: local variable 'artifacts_dir' referenced before assignment, continuando\nDEBUG Signature antes del fix: <Signature xmlns=\"http://www.w3.org/2000/09/xmldsig#\"/>\nDEBUG Signature despu\u00e9s del fix: <Signature xmlns=\"http://www.w3.org/2000/09/xmldsig#\"/>\nDEBUG: XML after removing newlines length: 5081\nGUARD-RAIL Signature: XMLDSig=1, SIFEN=0\n\ud83d\udd0d DEBUG: zip_base64 al inicio = presente\nDEBUG: Verificando ZIP reconstruido en ../artifacts/last_lote.zip: NOT FOUND\nDEBUG: Usando zip_base64 existente (ya tiene version='150' del passthrough)\n\u274c DEBUG: no encontr\u00e9 <sifen:xDE> en el SOAP final\n\ud83d\udd0d STAGE 13_soap_payload: 2953 bytes, SHA256: d651408221614b0525281e4c94535f2b2fdba28c20c7bf08489704d127f6b6c5\n   \ud83d\udcbe Guardado: artifacts/_stage_13_soap_payload.xml\n\u26a0\ufe0f  \u00a1CAMBIO DETECTADO! 12_from_zip -> 13_soap_payload\n   12_from_zip: 14f0a1e8cca8e81c69b217e9f9856c6cb30a653717d4c2d605f138f089d8969d\n   13_soap_payload: d651408221614b0525281e4c94535f2b2fdba28c20c7bf08489704d127f6b6c5\n\u2713 Lote construido:\n   dId: 202601181358353\n   ZIP bytes: 2084 (2.04 KB)\n   Base64 len: 2780\n   Payload XML total: 2953 bytes (2.88 KB)\n\n\ud83d\udce4 Enviando lote a SIFEN (siRecepLoteDE)...\n\n   WSDL: https://sifen-test.set.gov.py/de/ws/async/recibe-lote.wsdl?wsdl\n   Servicio: recibe_lote\n   Operaci\u00f3n: siRecepLoteDE\n\n\ud83d\udd0d Ejecutando preflight local...\nDEBUG: Signature encontrada, ns=http://www.w3.org/2000/09/xmldsig#, tag={http://www.w3.org/2000/09/xmldsig#}Signature\n\u274c PREFLIGHT FALL\u00d3: No se encontr\u00f3 <SignatureMethod> en la firma\n   Artifacts guardados en artifacts/preflight_*.xml y artifacts/preflight_zip.zip\n\n============================================================\n=== RESULT ===\nsuccess: False\nerror: PREFLIGHT FALL\u00d3: No se encontr\u00f3 <SignatureMethod> en la firma\nerror_type: PreflightValidationError\n============================================================\n",
  "stderr": "/Users/robinklaiss/Library/Python/3.9/lib/python/site-packages/urllib3/__init__.py:35: NotOpenSSLWarning: urllib3 v2 only supports OpenSSL 1.1.1+, currently the 'ssl' module is compiled with 'LibreSSL 2.8.3'. See: https://github.com/urllib3/urllib3/issues/3020\n  warnings.warn(\n",
  "sifen_code": "0160",
  "sifen_message": "XML Mal Formado."
}